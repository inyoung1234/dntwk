<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap"
          rel="stylesheet">
    <meta charset="UTF-8" name="viewport"
          content="width=device-width, maximum-scale=1.0, minimum-scale=1, user-scalable=yes,initial-scale=1.0"/>
    <link rel="shortcut icon" type="image/x-icon"
          href="https://farm66.staticflickr.com/65535/52426774298_021f5dfcb4_m.jpg">
    <script src="https://cdn.ckeditor.com/ckeditor5/35.4.0/super-build/ckeditor.js"></script>
    <title>웃자</title>
    <style>
        #container {
            width: 1000px;
            margin: 20px auto;
        }

        textarea {
            outline: none;
        }

        .ck-editor__editable[role="textbox"] {
            /* editing area */
            min-height: 200px;
            border: none;
            outline: none !important;
        }

        .ck-toolbar {
            border: 1px solid #ccced1 !important;
        }

        .ck-content .image {
            /* block images */
            max-width: 80%;
            margin: 20px auto;
        }

        .post-title {
            width: 980px;
            font-size: 30px;
            resize: none;
            border: none;
            border-bottom: 1px solid #ccced1;
            padding-top: 10px;
            padding-left: 10px;
        }

        .ck .ck-editor__editable_inline:focus {
            border: none !important;
            box-shadow: none !important;
        }
    </style>
</head>
<body>
<div id="container">
    <div class="post-title-div">
        <label>
            <textarea class="post-title" placeholder="제목을 입력하세요" style="height: 42px !important;"></textarea>
        </label>
    </div>
    <div id="editor">
    </div>
    <div>
        <button onclick="submit()">등록</button>
    </div>
    <div th:if="${CategoryListWithIdx}">카테고리 선택 :
        <select name="category-list" id="category-list">
            <option th:each="categories : ${CategoryListWithIdx}" th:text="${categories.categoryName}" th:value="${categories.categoryIdx}"></option>
        </select>
    </div>
</div>
</body>
<script>
    CKEDITOR.ClassicEditor
        .create(document.querySelector('#editor'), {
            toolbar: {
                items: [
                    'heading', 'fontFamily', '|',
                    'bold', 'italic', 'strikethrough', 'underline', '|',
                    'bulletedList', 'numberedList', '|',
                    'undo', 'redo',
                    '-',
                    'fontSize', 'fontColor', 'highlight', '|',
                    'alignment', '|',
                    'link', 'insertImage', 'blockQuote', 'mediaEmbed', 'codeBlock', 'htmlEmbed', '|',
                    'specialCharacters', 'horizontalLine', 'pageBreak',
                ],
                shouldNotGroupWhenFull: true
            },
            // Changing the language of the interface requires loading the language file using the <script> tag.
            // language: 'es',
            list: {
                properties: {
                    styles: true,
                    startIndex: true,
                    reversed: true
                }
            },
            // https://ckeditor.com/docs/ckeditor5/latest/features/headings.html#configuration
            heading: {
                options: [
                    {model: 'paragraph', title: '본문', class: 'ck-heading_paragraph'},
                    {model: 'heading1', view: 'h1', title: '제목 1', class: 'ck-heading_heading1'},
                    {model: 'heading2', view: 'h2', title: '제목 2', class: 'ck-heading_heading2'},
                    {model: 'heading3', view: 'h3', title: '제목 3', class: 'ck-heading_heading3'},
                ]
            },
            fontFamily: {
                options: [
                    'default',
                    'Arial, Helvetica, sans-serif',
                    'Courier New, Courier, monospace',
                    'Georgia, serif',
                    'Lucida Sans Unicode, Lucida Grande, sans-serif',
                    'Tahoma, Geneva, sans-serif',
                    'Times New Roman, Times, serif',
                    'Trebuchet MS, Helvetica, sans-serif',
                    'Verdana, Geneva, sans-serif'
                ],
                supportAllValues: true
            },
            // https://ckeditor.com/docs/ckeditor5/latest/features/font.html#configuring-the-font-size-feature
            fontSize: {
                options: [10, 12, 14, 'default', 18, 20, 22],
                supportAllValues: true
            },
            // Be careful with the setting below. It instructs CKEditor to accept ALL HTML markup.
            // https://ckeditor.com/docs/ckeditor5/latest/features/general-html-support.html#enabling-all-html-features
            htmlSupport: {
                allow: [
                    {
                        name: /.*/,
                        attributes: true,
                        classes: true,
                        styles: true
                    }
                ]
            },
            // Be careful with enabling previews
            // https://ckeditor.com/docs/ckeditor5/latest/features/html-embed.html#content-previews
            htmlEmbed: {
                showPreviews: true
            },
            // https://ckeditor.com/docs/ckeditor5/latest/features/link.html#custom-link-attributes-decorators
            link: {
                decorators: {
                    addTargetToExternalLinks: true,
                    toggleDownloadable: {
                        mode: 'manual',
                    }
                }
            },
            // https://ckeditor.com/docs/ckeditor5/latest/features/mentions.html#configuration
            mention: {
                feeds: [
                    {
                        marker: '@',
                        feed: [
                            '@apple', '@bears', '@brownie', '@cake', '@cake', '@candy', '@canes', '@chocolate', '@cookie', '@cotton', '@cream',
                            '@cupcake', '@danish', '@donut', '@dragée', '@fruitcake', '@gingerbread', '@gummi', '@ice', '@jelly-o',
                            '@liquorice', '@macaroon', '@marzipan', '@oat', '@pie', '@plum', '@pudding', '@sesame', '@snaps', '@soufflé',
                            '@sugar', '@sweet', '@topping', '@wafer'
                        ],
                        minimumCharacters: 1
                    }
                ]
            },
            // The "super-build" contains more premium features that require additional configuration, disable them below.
            // Do not turn them on unless you read the documentation and know how to configure them and setup the editor.
            removePlugins: [
                // These two are commercial, but you can try them out without registering to a trial.
                // 'ExportPdf',
                // 'ExportWord',
                'CKBox',
                'CKFinder',
                'EasyImage',
                // This sample uses the Base64UploadAdapter to handle image uploads as it requires no configuration.
                // https://ckeditor.com/docs/ckeditor5/latest/features/images/image-upload/base64-upload-adapter.html
                // Storing images as Base64 is usually a very bad idea.
                // Replace it on production website with other solutions:
                // https://ckeditor.com/docs/ckeditor5/latest/features/images/image-upload/image-upload.html
                // 'Base64UploadAdapter',
                'RealTimeCollaborativeComments',
                'RealTimeCollaborativeTrackChanges',
                'RealTimeCollaborativeRevisionHistory',
                'PresenceList',
                'Comments',
                'TrackChanges',
                'TrackChangesData',
                'RevisionHistory',
                'Pagination',
                'WProofreader',
                // Careful, with the Mathtype plugin CKEditor will not load when loading this sample
                // from a local file system (file://) - load this site via HTTP server if you enable MathType
                'MathType'
            ],
            language: 'ko'
        })
        .then(editor => {
            document.querySelector('.ck-editor__main').insertBefore(document.querySelector('.post-title-div'), document.querySelector('.ck-blurred'));
        })
        .catch(error => {
            console.error(error);
        });

    function submit() {
        const createPostDTO = {
            postContents: document.querySelector('.ck-blurred').innerHTML,
            postName: document.querySelector('.post-title').value,
            postCategory: document.querySelector('#category-list').value,
        }
        fetch("/post", {
            method: "post",
            headers: {
                "Content-Type": "application/json;charset=utf-8"
            },
            body: JSON.stringify(createPostDTO)
        });
    }
</script>
</html>
